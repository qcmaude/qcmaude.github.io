{"ast":null,"code":"import { copy } from '../common/common';\n/**\n * A [[TransitionHookFn]] which updates global UI-Router state\n *\n * Registered using `transitionService.onBefore({}, updateGlobalState);`\n *\n * Before a [[Transition]] starts, updates the global value of \"the current transition\" ([[Globals.transition]]).\n * After a successful [[Transition]], updates the global values of \"the current state\"\n * ([[Globals.current]] and [[Globals.$current]]) and \"the current param values\" ([[Globals.params]]).\n *\n * See also the deprecated properties:\n * [[StateService.transition]], [[StateService.current]], [[StateService.params]]\n */\n\nvar updateGlobalState = function (trans) {\n  var globals = trans.router.globals;\n\n  var transitionSuccessful = function () {\n    globals.successfulTransitions.enqueue(trans);\n    globals.$current = trans.$to();\n    globals.current = globals.$current.self;\n    copy(trans.params(), globals.params);\n  };\n\n  var clearCurrentTransition = function () {\n    // Do not clear globals.transition if a different transition has started in the meantime\n    if (globals.transition === trans) globals.transition = null;\n  };\n\n  trans.onSuccess({}, transitionSuccessful, {\n    priority: 10000\n  });\n  trans.promise.then(clearCurrentTransition, clearCurrentTransition);\n};\n\nexport var registerUpdateGlobalState = function (transitionService) {\n  return transitionService.onCreate({}, updateGlobalState);\n};","map":{"version":3,"sources":["@uirouter/core/hooks/updateGlobals.ts"],"names":[],"mappings":"AAEA,SAAS,IAAT,QAAqB,kBAArB;AAGA;;;;;;;;;;;AAWG;;AACH,IAAM,iBAAiB,GAAG,UAAC,KAAD,EAAkB;AAC1C,MAAM,OAAO,GAAG,KAAK,CAAC,MAAN,CAAa,OAA7B;;AAEA,MAAM,oBAAoB,GAAG,YAAA;AAC3B,IAAA,OAAO,CAAC,qBAAR,CAA8B,OAA9B,CAAsC,KAAtC;AACA,IAAA,OAAO,CAAC,QAAR,GAAmB,KAAK,CAAC,GAAN,EAAnB;AACA,IAAA,OAAO,CAAC,OAAR,GAAkB,OAAO,CAAC,QAAR,CAAiB,IAAnC;AAEA,IAAA,IAAI,CAAC,KAAK,CAAC,MAAN,EAAD,EAAiB,OAAO,CAAC,MAAzB,CAAJ;AACD,GAND;;AAQA,MAAM,sBAAsB,GAAG,YAAA;AAC7B;AACA,QAAI,OAAO,CAAC,UAAR,KAAuB,KAA3B,EAAkC,OAAO,CAAC,UAAR,GAAqB,IAArB;AACnC,GAHD;;AAKA,EAAA,KAAK,CAAC,SAAN,CAAgB,EAAhB,EAAoB,oBAApB,EAA0C;AAAE,IAAA,QAAQ,EAAE;AAAZ,GAA1C;AACA,EAAA,KAAK,CAAC,OAAN,CAAc,IAAd,CAAmB,sBAAnB,EAA2C,sBAA3C;AACD,CAlBD;;AAoBA,OAAO,IAAM,yBAAyB,GAAG,UAAC,iBAAD,EAAqC;AAC5E,SAAA,iBAAiB,CAAC,QAAlB,CAA2B,EAA3B,EAA+B,iBAA/B,CAAA;AAAiD,CAD5C","sourcesContent":["/** @packageDocumentation @internalapi @module hooks */\nimport { Transition } from '../transition/transition';\nimport { copy } from '../common/common';\nimport { TransitionService } from '../transition/transitionService';\n\n/**\n * A [[TransitionHookFn]] which updates global UI-Router state\n *\n * Registered using `transitionService.onBefore({}, updateGlobalState);`\n *\n * Before a [[Transition]] starts, updates the global value of \"the current transition\" ([[Globals.transition]]).\n * After a successful [[Transition]], updates the global values of \"the current state\"\n * ([[Globals.current]] and [[Globals.$current]]) and \"the current param values\" ([[Globals.params]]).\n *\n * See also the deprecated properties:\n * [[StateService.transition]], [[StateService.current]], [[StateService.params]]\n */\nconst updateGlobalState = (trans: Transition) => {\n  const globals = trans.router.globals;\n\n  const transitionSuccessful = () => {\n    globals.successfulTransitions.enqueue(trans);\n    globals.$current = trans.$to();\n    globals.current = globals.$current.self;\n\n    copy(trans.params(), globals.params);\n  };\n\n  const clearCurrentTransition = () => {\n    // Do not clear globals.transition if a different transition has started in the meantime\n    if (globals.transition === trans) globals.transition = null;\n  };\n\n  trans.onSuccess({}, transitionSuccessful, { priority: 10000 });\n  trans.promise.then(clearCurrentTransition, clearCurrentTransition);\n};\n\nexport const registerUpdateGlobalState = (transitionService: TransitionService) =>\n  transitionService.onCreate({}, updateGlobalState);\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}